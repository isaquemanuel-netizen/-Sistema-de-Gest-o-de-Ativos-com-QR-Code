<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Controle de Ativos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    .truncate {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  </style>
</head>
<body class="bg-light">

  <!-- Cabeçalho -->
  <header class="bg-white shadow-sm mb-4 py-3">
    <div class="container d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" style="height: 60px;" class="me-3" />
        <h4 class="mb-0">Controle de Ativos</h4>
      </div>
      <div class="d-flex gap-2">
        <a href="/exportar" class="btn btn-outline-primary">Exportar para Excel</a>
        <a href="/novo" class="btn btn-success">Adicionar Ativo</a>
      </div>
    </div>
  </header>

  <!-- Controles -->
  <div class="container mb-3 d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2">
    <form method="get" class="d-flex flex-grow-1 me-2">
      <input type="text" name="busca" id="campoBusca" value="{{ busca or '' }}" class="form-control" placeholder="Buscar por nome, SN, descrição ou responsável..." />
      <button type="submit" class="btn btn-primary ms-2">Buscar</button>
    </form>
    <div class="btn-group mt-2 mt-md-0" role="group">
      <button class="btn btn-outline-secondary" onclick="mudarVisualizacao('cards')">
        <i class="bi bi-grid-3x3-gap"></i> Cards
      </button>
      <button class="btn btn-outline-secondary" onclick="mudarVisualizacao('lista')">
        <i class="bi bi-list"></i> Lista
      </button>
    </div>
  </div>

  <!-- Cards -->
  <div class="container" id="viewCards">
    <div class="row" id="listaCards">
      {% for ativo in ativos %}
      <div class="col-md-6 col-lg-4 mb-3">
        <div class="card h-100 shadow-sm">
          <div class="card-body d-flex flex-column">
            <div class="d-flex align-items-center mb-2">
              <img src="/static/qrcodes/ativo_{{ ativo[0] }}.png" alt="QR" style="height: 60px;" class="me-3" />
              <div>
                <h5 class="card-title mb-0">{{ ativo[1] }}</h5>
                <small class="text-muted truncate">{{ ativo[2] }}</small>
              </div>
            </div>
            <p class="mb-1">SN: <strong>{{ ativo[3] }}</strong></p>
            <p class="mb-1">Responsável: <strong>{{ ativo[6] }}</strong></p>
            <p class="mb-2">
              Estado:
              <span class="badge {{ 'bg-success' if ativo[7]=='Ativo' else 'bg-danger' if ativo[7]=='Inativo' else 'bg-warning text-dark' if ativo[7]=='Em Manutenção' else 'bg-secondary' }}">{{ ativo[7] }}</span>
            </p>
            <button class="btn btn-outline-primary mt-auto" data-bs-toggle="modal" data-bs-target="#modalAtivo"
              onclick='abrirModal({{ ativo|tojson }})'>
              <i class="bi bi-eye"></i> Ver Detalhes
            </button>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Lista -->
  <div class="container" id="viewLista" style="display: none;">
    <div id="listaLista">
      {% for ativo in ativos %}
      <div class="list-group mb-2">
        <div class="list-group-item d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3">
          <div class="d-flex flex-column flex-md-row align-items-md-center gap-3 flex-fill">
            <img src="/static/qrcodes/ativo_{{ ativo[0] }}.png" alt="QR" style="height: 60px;">
            <div class="flex-grow-1">
              <h5 class="mb-1">{{ ativo[1] }}</h5>
              <div class="truncate text-muted">{{ ativo[2] }}</div>
              <div>SN: <strong>{{ ativo[3] }}</strong></div>
              <div>Responsável: <strong>{{ ativo[6] }}</strong></div>
              <div>
                Estado:
                <span class="badge {{ 'bg-success' if ativo[7]=='Ativo' else 'bg-danger' if ativo[7]=='Inativo' else 'bg-warning text-dark' if ativo[7]=='Em Manutenção' else 'bg-secondary' }}">{{ ativo[7] }}</span>
              </div>
            </div>
          </div>
          <div>
            <button class="btn btn-outline-primary btn-sm"
              data-bs-toggle="modal" data-bs-target="#modalAtivo"
              onclick='abrirModal({{ ativo|tojson }})'>
              <i class="bi bi-eye"></i> Ver Detalhes
            </button>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Nenhum resultado -->
  <div class="container text-center mt-4">
    {% if not ativos %}
    <div id="msgNenhumAtivo" class="alert alert-warning">
      Nenhum ativo encontrado.
    </div>
    {% endif %}
  </div>

  <!-- Modal -->
  <div class="modal fade" id="modalAtivo" tabindex="-1" aria-labelledby="modalAtivoLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalAtivoLabel">Detalhes do Ativo</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <p><strong>Nome:</strong> <span id="modalNome"></span></p>
          <p><strong>Descrição:</strong> <span id="modalDescricao"></span></p>
          <p><strong>Serial:</strong> <span id="modalSerial"></span></p>
          <p><strong>Local:</strong> <span id="modalLocal"></span></p>
          <p><strong>Responsável:</strong> <span id="modalResponsavel"></span></p>
          <p><strong>Aquisição:</strong> <span id="modalAquisicao"></span></p>
          <p><strong>Estado:</strong> <span id="modalEstado"></span></p>
        </div>
        <div class="modal-footer">
          <a href="#" class="btn btn-primary" id="linkEditar">Editar Ativo</a>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function mudarVisualizacao(tipo) {
      document.getElementById('viewCards').style.display = tipo === 'cards' ? 'block' : 'none';
      document.getElementById('viewLista').style.display = tipo === 'lista' ? 'block' : 'none';
    }

    function abrirModal(ativo) {
      document.getElementById('modalNome').textContent = ativo[1];
      document.getElementById('modalDescricao').textContent = ativo[2];
      document.getElementById('modalSerial').textContent = ativo[3];
      document.getElementById('modalResponsavel').textContent = ativo[6];
      document.getElementById('modalLocal').textContent = ativo[5];
      document.getElementById('modalAquisicao').textContent = ativo[4];
      document.getElementById('modalEstado').textContent = ativo[7];
      document.getElementById('linkEditar').href = `/ativo/${ativo[0]}`;
    }
  </script>
</body>
</html>
